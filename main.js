!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,a)=>{const r=t.id+"-error";e.querySelector("#"+r).textContent="",t.classList.remove(a.inputErrorClass)},a=(e,t,a)=>{(e=>Array.from(e).some(e=>!e.validity.valid))(e)?(t.classList.add(a.inactiveButtonClass),t.disabled=!0):(t.classList.remove(a.inactiveButtonClass),t.disabled=!1)},r=(e,a,r)=>{a.forEach(a=>{t(e,a,r)}),((e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0})(e.querySelector(r.submitButtonSelector),r)};function o(e,t,a="Save",r="Saving..."){e.textContent=t?r:a}var n=class{constructor(e,t,a,r,o){this._data=e,this._templateSelector=t,this._handleLike=a,this._handleDelete=r,this._handlePreview=o,this._cardTemplate=document.querySelector(this._templateSelector).content}getCardElement(){const e=this._cardTemplate.cloneNode(!0).querySelector(".card"),t=e.querySelector(".card__title"),a=e.querySelector(".card__image"),r=e.querySelector(".card__like-button"),o=e.querySelector(".card__delete-button");return a.src=this._data.link,a.alt=this._data.name,t.textContent=this._data.name,this._data.isLiked&&r.classList.add("card__like-button_active"),r.addEventListener("click",e=>{this._handleLike(e,this._data)}),o.addEventListener("click",()=>this._handleDelete(e,this._data)),a.addEventListener("click",()=>{this._handlePreview(this._data)}),e}},s=class{constructor(e){this._modal=e,this._handleEscClose=this._handleEscClose.bind(this),this._closeButton=e.querySelector(".modal__close-button"),this._closeButton.addEventListener("click",()=>this.closeModal()),this._modal.addEventListener("click",e=>{e.target===this._modal&&this.closeModal()})}openModal(){this._modal.classList.add("modal_is-open"),document.addEventListener("keydown",this._handleEscClose)}closeModal(){this._modal.classList.remove("modal_is-open"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.closeModal()}};const l=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}updateUserInfo([e,t]){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}updateUserAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}addNewCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}changeLikeStatus(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"PUT":"DELETE",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"13cfda04-b97a-4769-ae32-a01aa8ac4519","Content-Type":"application/json"}}),i=new class{constructor({nameSelector:e,aboutSelector:t,avatarSelector:a}){this._nameElement=document.querySelector(e),this._aboutElement=document.querySelector(t),this._avatarElement=document.querySelector(a)}getUserInfo(){return{name:this._nameElement.textContent,about:this._aboutElement.textContent,avatar:this._avatarElement.src}}setUserInfo({name:e,about:t,avatar:a}){e&&(this._nameElement.textContent=e),t&&(this._aboutElement.textContent=t),a&&(this._avatarElement.src=a)}}({nameSelector:".profile__name",aboutSelector:".profile__description",avatarSelector:".profile__avatar"}),d={preview:new s(document.querySelector("#preview-modal")),editProfile:new s(document.querySelector("#edit-profile-modal")),newPost:new s(document.querySelector("#new-post-modal")),editAvatar:new s(document.querySelector("#edit-avatar-modal")),deleteCard:new s(document.querySelector("#delete-card-modal"))},c=document.querySelector(".modal__image"),u=document.querySelector(".modal__caption"),h=document.querySelector(".cards__list"),m=document.querySelector(".profile__edit-button"),_=document.querySelector("#edit-profile-modal .modal__form"),p=document.querySelector("#profile-name-input"),v=document.querySelector("#profile-description-input"),f=_.querySelector(".modal__submit-button"),S=document.querySelector(".profile__avatar-button"),b=document.querySelector("#edit-avatar-modal .modal__form"),y=document.querySelector("#profile-avatar-input"),E=b.querySelector(".modal__submit-button"),q=document.querySelector(".profile__post-button"),k=document.querySelector("#new-post-modal .modal__form"),C=document.querySelector("#image-link-input"),g=document.querySelector("#image-caption-input"),L=k.querySelector(".modal__submit-button"),w=document.querySelector(".modal__delete-button"),U=document.querySelector(".modal__cancel-button");let M,A;function I(e){c.src=e.link,c.alt=e.name,u.textContent=e.name,d.preview.openModal()}function P(e,t){M=e,A=t._id,d.deleteCard.openModal()}function D(e,t){const a=e.target,r=a.classList.contains("card__like-button_active");l.changeLikeStatus(t._id,!r).then(()=>{a.classList.toggle("card__like-button_active",!r)}).catch(e=>{console.error("Error changing like status:",e)})}var $;l.getAppInfo().then(([e,t])=>{e.forEach(e=>{const t=new n(e,"#card-template",D,P,I);h.append(t.getCardElement())}),i.setUserInfo({name:t.name,about:t.about,avatar:t.avatar})}).catch(e=>{console.error("Error fetching data:",e)}),m.addEventListener("click",()=>{const t=i.getUserInfo();p.value=t.name,v.value=t.about,d.editProfile.openModal(),r(_,_.querySelectorAll(".modal__input"),e)}),_.addEventListener("submit",function(e){e.preventDefault(),o(f,!0),l.updateUserInfo([p.value,v.value]).then(e=>{i.setUserInfo({name:e.name,about:e.about}),d.editProfile.closeModal(),_.reset()}).catch(e=>{console.error("Error updating user info:",e)}).finally(()=>{f.disabled=!1,o(f,!1)})}),q.addEventListener("click",()=>d.newPost.openModal()),k.addEventListener("submit",function(t){t.preventDefault(),o(L,!0),l.addNewCard({link:C.value,name:g.value}).then(t=>{const a=new n(t,"#card-template",D,P,I);h.prepend(a.getCardElement()),d.newPost.closeModal(),k.reset(),r(k,k.querySelectorAll(".modal__input"),e)}).catch(e=>{console.error("Error adding new card:",e)}).finally(()=>{L.disabled=!1,o(L,!1)})}),S.addEventListener("click",()=>d.editAvatar.openModal()),b.addEventListener("submit",function(e){e.preventDefault(),o(E,!0);const t=y.value;l.updateUserAvatar(t).then(e=>{i.setUserInfo({avatar:e.avatar}),d.editAvatar.closeModal(),b.reset()}).catch(e=>{console.error("Error updating avatar:",e)}).finally(()=>{E.disabled=!1,o(E,!1)})}),w.addEventListener("click",function(){o(w,!0,"Delete","Deleting..."),l.deleteCard(A).then(()=>{M.remove(),d.deleteCard.closeModal()}).catch(e=>{console.error("Error deleting card:",e)}).finally(()=>{w.disabled=!1,o(w,!1,"Delete","Deleting...")})}),U.addEventListener("click",()=>d.deleteCard.closeModal()),$=e,document.querySelectorAll($.formSelector).forEach(e=>{((e,r)=>{const o=e.querySelectorAll(r.inputSelector),n=e.querySelector(r.submitButtonSelector);o.forEach(s=>{s.addEventListener("input",()=>{((e,a,r)=>{a.validity.valid?t(e,a,r):((e,t,a,r)=>{const o=t.id+"-error";e.querySelector("#"+o).textContent=a,t.classList.add(r.inputErrorClass)})(e,a,a.validationMessage,r)})(e,s,r),a(o,n,r)})}),a(o,n,r)})(e,$)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUloQixFQUFPTCxrQkFZaENpSyxDQUNFOUosRUFDQUMsRUFDQUEsRUFBYStKLGtCQUNiOUosSUEwQ0EySixDQUFtQjdKLEVBQWFDLEVBQWNDLEdBQzlDTyxFQUFrQkMsRUFBV0MsRUFBZVQsT0FJaERPLEVBQWtCQyxFQUFXQyxFQUFlVCxJQU0xQzBKLENBQWtCNUosRUFBYUUsSSIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvaGVscGVycy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL2NvbXBvbmVudHMvTW9kYWwuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcclxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIixcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnV0dG9uX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxyXG59O1xyXG5cclxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBjb25maWcpID0+IHtcclxuICBjb25zdCBlcnJvck1lc3NhZ2VJRCA9IGlucHV0RWxlbWVudC5pZCArIFwiLWVycm9yXCI7XHJcbiAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjXCIgKyBlcnJvck1lc3NhZ2VJRCk7XHJcbiAgZXJyb3JNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxufTtcclxuXHJcbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGVycm9yTWVzc2FnZUlEID0gaW5wdXRFbGVtZW50LmlkICsgXCItZXJyb3JcIjtcclxuICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcIiNcIiArIGVycm9yTWVzc2FnZUlEKTtcclxuICBlcnJvck1lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxufTtcclxuXHJcbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcclxuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgc2hvd0lucHV0RXJyb3IoXHJcbiAgICAgIGZvcm1FbGVtZW50LFxyXG4gICAgICBpbnB1dEVsZW1lbnQsXHJcbiAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcclxuICAgICAgY29uZmlnXHJcbiAgICApO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcclxuICByZXR1cm4gQXJyYXkuZnJvbShpbnB1dExpc3QpLnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZykgPT4ge1xyXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xyXG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XHJcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsZW1lbnQsIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XHJcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcclxuICB9KTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcclxufTtcclxuXHJcbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcclxuICBjb25zdCBpbnB1dExpc3QgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XHJcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcclxuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XHJcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBjb25maWcpO1xyXG4gIH0pO1xyXG59O1xyXG4iLCJleHBvcnQgZnVuY3Rpb24gc2V0QnV0dG9uVGV4dChcclxuICBidXR0b24sXHJcbiAgaXNMb2FkaW5nLFxyXG4gIGRlZmF1bHRUZXh0ID0gXCJTYXZlXCIsXHJcbiAgbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiXHJcbikge1xyXG4gIGlmIChpc0xvYWRpbmcpIHtcclxuICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xyXG4gIH0gZWxzZSB7XHJcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSBkZWZhdWx0VGV4dDtcclxuICB9XHJcbn1cclxuIiwiY2xhc3MgQ2FyZCB7XHJcbiAgY29uc3RydWN0b3IoZGF0YSwgdGVtcGxhdGVTZWxlY3RvciwgaGFuZGxlTGlrZSwgaGFuZGxlRGVsZXRlLCBoYW5kbGVQcmV2aWV3KSB7XHJcbiAgICB0aGlzLl9kYXRhID0gZGF0YTtcclxuICAgIHRoaXMuX3RlbXBsYXRlU2VsZWN0b3IgPSB0ZW1wbGF0ZVNlbGVjdG9yO1xyXG4gICAgdGhpcy5faGFuZGxlTGlrZSA9IGhhbmRsZUxpa2U7XHJcbiAgICB0aGlzLl9oYW5kbGVEZWxldGUgPSBoYW5kbGVEZWxldGU7XHJcbiAgICB0aGlzLl9oYW5kbGVQcmV2aWV3ID0gaGFuZGxlUHJldmlldztcclxuXHJcbiAgICB0aGlzLl9jYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX3RlbXBsYXRlU2VsZWN0b3IpLmNvbnRlbnQ7XHJcbiAgfVxyXG5cclxuICBnZXRDYXJkRWxlbWVudCgpIHtcclxuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gdGhpcy5fY2FyZFRlbXBsYXRlXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSlcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKTtcclxuICAgIGNvbnN0IGNhcmRUaXRsZUVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xyXG4gICAgY29uc3QgY2FyZEltYWdlRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcbiAgICBjb25zdCBjYXJkTGlrZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XHJcbiAgICBjb25zdCBjYXJkRGVsZXRlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xyXG5cclxuICAgIGNhcmRJbWFnZUVsZW1lbnQuc3JjID0gdGhpcy5fZGF0YS5saW5rO1xyXG4gICAgY2FyZEltYWdlRWxlbWVudC5hbHQgPSB0aGlzLl9kYXRhLm5hbWU7XHJcbiAgICBjYXJkVGl0bGVFbGVtZW50LnRleHRDb250ZW50ID0gdGhpcy5fZGF0YS5uYW1lO1xyXG5cclxuICAgIGlmICh0aGlzLl9kYXRhLmlzTGlrZWQpIHtcclxuICAgICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICAgIH1cclxuXHJcbiAgICBjYXJkTGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xyXG4gICAgICB0aGlzLl9oYW5kbGVMaWtlKGV2dCwgdGhpcy5fZGF0YSk7XHJcbiAgICB9KTtcclxuICAgIGNhcmREZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZShjYXJkRWxlbWVudCwgdGhpcy5fZGF0YSlcclxuICAgICk7XHJcblxyXG4gICAgY2FyZEltYWdlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICB0aGlzLl9oYW5kbGVQcmV2aWV3KHRoaXMuX2RhdGEpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQ2FyZDtcclxuIiwiY2xhc3MgTW9kYWwge1xyXG4gIGNvbnN0cnVjdG9yKG1vZGFsKSB7XHJcbiAgICB0aGlzLl9tb2RhbCA9IG1vZGFsO1xyXG4gICAgdGhpcy5faGFuZGxlRXNjQ2xvc2UgPSB0aGlzLl9oYW5kbGVFc2NDbG9zZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5fY2xvc2VCdXR0b24gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIik7XHJcbiAgICB0aGlzLl9jbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5jbG9zZU1vZGFsKCkpO1xyXG4gICAgdGhpcy5fbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcclxuICAgICAgaWYgKGV2dC50YXJnZXQgPT09IHRoaXMuX21vZGFsKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZU1vZGFsKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICBvcGVuTW9kYWwoKSB7XHJcbiAgICB0aGlzLl9tb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlblwiKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIGNsb3NlTW9kYWwoKSB7XHJcbiAgICB0aGlzLl9tb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfaXMtb3BlblwiKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIF9oYW5kbGVFc2NDbG9zZShldnQpIHtcclxuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2VNb2RhbCgpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgTW9kYWw7XHJcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcblxyXG5pbXBvcnQge1xyXG4gIHJlc2V0VmFsaWRhdGlvbixcclxuICBlbmFibGVWYWxpZGF0aW9uLFxyXG4gIHNldHRpbmdzLFxyXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcclxuaW1wb3J0IHsgc2V0QnV0dG9uVGV4dCB9IGZyb20gXCIuLi91dGlscy9oZWxwZXJzLmpzXCI7XHJcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XHJcbmltcG9ydCBNb2RhbCBmcm9tIFwiLi4vY29tcG9uZW50cy9Nb2RhbC5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuXHJcbi8vIEluc3RhbnRpYXRlIEFQSVxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogXCIxM2NmZGEwNC1iOTdhLTQ3NjktYWUzMi1hMDFhYThhYzQ1MTlcIixcclxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gIH0sXHJcbn0pO1xyXG5cclxuLy8gSW5zdGFudGlhdGUgVXNlckluZm9cclxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xyXG4gIG5hbWVTZWxlY3RvcjogXCIucHJvZmlsZV9fbmFtZVwiLFxyXG4gIGFib3V0U2VsZWN0b3I6IFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIsXHJcbiAgYXZhdGFyU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2F2YXRhclwiLFxyXG59KTtcclxuXHJcbi8vIE1vZGFsIGVsZW1lbnRzXHJcbmNvbnN0IG1vZGFscyA9IHtcclxuICBwcmV2aWV3OiBuZXcgTW9kYWwoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpKSxcclxuICBlZGl0UHJvZmlsZTogbmV3IE1vZGFsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpKSxcclxuICBuZXdQb3N0OiBuZXcgTW9kYWwoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXctcG9zdC1tb2RhbFwiKSksXHJcbiAgZWRpdEF2YXRhcjogbmV3IE1vZGFsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIikpLFxyXG4gIGRlbGV0ZUNhcmQ6IG5ldyBNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1jYXJkLW1vZGFsXCIpKSxcclxufTtcclxuXHJcbi8vIERPTSByZWZlcmVuY2VzIGZvciBjYXJkcyBhbmQgZm9ybXNcclxuY29uc3QgcHJldmlld0ltYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG5jb25zdCBwcmV2aWV3Q2FwdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xyXG5cclxuY29uc3QgY2FyZExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xyXG5cclxuLy8gRWRpdCBQcm9maWxlIGVsZW1lbnRzXHJcbmNvbnN0IGVkaXRQcm9maWxlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcclxuY29uc3QgZWRpdFByb2ZpbGVGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICBcIiNlZGl0LXByb2ZpbGUtbW9kYWwgLm1vZGFsX19mb3JtXCJcclxuKTtcclxuY29uc3QgZWRpdFByb2ZpbGVOYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcclxuY29uc3QgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcclxuKTtcclxuY29uc3QgZWRpdFByb2ZpbGVTdWJtaXRCdXR0b24gPSBlZGl0UHJvZmlsZUZvcm0ucXVlcnlTZWxlY3RvcihcclxuICBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiXHJcbik7XHJcblxyXG4vLyBFZGl0IEF2YXRhciBlbGVtZW50c1xyXG5jb25zdCBlZGl0QXZhdGFyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnV0dG9uXCIpO1xyXG5jb25zdCBlZGl0QXZhdGFyRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIjZWRpdC1hdmF0YXItbW9kYWwgLm1vZGFsX19mb3JtXCJcclxuKTtcclxuY29uc3QgZWRpdEF2YXRhcklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWF2YXRhci1pbnB1dFwiKTtcclxuY29uc3QgZWRpdEF2YXRhclN1Ym1pdEJ1dHRvbiA9IGVkaXRBdmF0YXJGb3JtLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIlxyXG4pO1xyXG5cclxuLy8gTmV3IHBvc3QgZWxlbWVudHNcclxuY29uc3QgbmV3UG9zdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fcG9zdC1idXR0b25cIik7XHJcbmNvbnN0IG5ld1Bvc3RGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXctcG9zdC1tb2RhbCAubW9kYWxfX2Zvcm1cIik7XHJcbmNvbnN0IG5ld1Bvc3RJbWFnZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNpbWFnZS1saW5rLWlucHV0XCIpO1xyXG5jb25zdCBuZXdQb3N0Q2FwdGlvbklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNpbWFnZS1jYXB0aW9uLWlucHV0XCIpO1xyXG5jb25zdCBuZXdQb3N0U3VibWl0QnV0dG9uID0gbmV3UG9zdEZvcm0ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiKTtcclxuXHJcbi8vIERlbGV0ZSBwb3N0IGVsZW1lbnRzXHJcbmNvbnN0IGRlbGV0ZUNvbmZpcm1CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19kZWxldGUtYnV0dG9uXCIpO1xyXG5jb25zdCBkZWxldGVDYW5jZWxCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYW5jZWwtYnV0dG9uXCIpO1xyXG5cclxuLy8gVmFyaWFibGVzIGZvciBkZWxldGUgc3RhdGVcclxubGV0IHNlbGVjdGVkQ2FyZCwgc2VsZWN0ZWRDYXJkSWQ7XHJcblxyXG4vLyBGZXRjaCBpbml0aWFsIGRhdGFcclxuYXBpXHJcbiAgLmdldEFwcEluZm8oKVxyXG4gIC50aGVuKChbY2FyZHMsIHVzZXJEYXRhXSkgPT4ge1xyXG4gICAgY2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICBjb25zdCBjYXJkID0gbmV3IENhcmQoXHJcbiAgICAgICAgaXRlbSxcclxuICAgICAgICBcIiNjYXJkLXRlbXBsYXRlXCIsXHJcbiAgICAgICAgaGFuZGxlTGlrZSxcclxuICAgICAgICBoYW5kbGVEZWxldGVDYXJkLFxyXG4gICAgICAgIGhhbmRsZVByZXZpZXdcclxuICAgICAgKTtcclxuICAgICAgY2FyZExpc3QuYXBwZW5kKGNhcmQuZ2V0Q2FyZEVsZW1lbnQoKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7XHJcbiAgICAgIG5hbWU6IHVzZXJEYXRhLm5hbWUsXHJcbiAgICAgIGFib3V0OiB1c2VyRGF0YS5hYm91dCxcclxuICAgICAgYXZhdGFyOiB1c2VyRGF0YS5hdmF0YXIsXHJcbiAgICB9KTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBkYXRhOlwiLCBlcnJvcik7XHJcbiAgfSk7XHJcblxyXG4vLyBIYW5kbGVyc1xyXG5mdW5jdGlvbiBoYW5kbGVQcmV2aWV3KGRhdGEpIHtcclxuICBwcmV2aWV3SW1hZ2VFbGVtZW50LnNyYyA9IGRhdGEubGluaztcclxuICBwcmV2aWV3SW1hZ2VFbGVtZW50LmFsdCA9IGRhdGEubmFtZTtcclxuICBwcmV2aWV3Q2FwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgbW9kYWxzLnByZXZpZXcub3Blbk1vZGFsKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEpIHtcclxuICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcclxuICBzZWxlY3RlZENhcmRJZCA9IGRhdGEuX2lkO1xyXG4gIG1vZGFscy5kZWxldGVDYXJkLm9wZW5Nb2RhbCgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVFZGl0UHJvZmlsZUZvcm1TdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgc2V0QnV0dG9uVGV4dChlZGl0UHJvZmlsZVN1Ym1pdEJ1dHRvbiwgdHJ1ZSk7XHJcbiAgYXBpXHJcbiAgICAudXBkYXRlVXNlckluZm8oW1xyXG4gICAgICBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZSxcclxuICAgICAgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxyXG4gICAgXSlcclxuICAgIC50aGVuKCh1cGRhdGVkVXNlckluZm8pID0+IHtcclxuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xyXG4gICAgICAgIG5hbWU6IHVwZGF0ZWRVc2VySW5mby5uYW1lLFxyXG4gICAgICAgIGFib3V0OiB1cGRhdGVkVXNlckluZm8uYWJvdXQsXHJcbiAgICAgIH0pO1xyXG4gICAgICBtb2RhbHMuZWRpdFByb2ZpbGUuY2xvc2VNb2RhbCgpO1xyXG4gICAgICBlZGl0UHJvZmlsZUZvcm0ucmVzZXQoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyB1c2VyIGluZm86XCIsIGVycm9yKTtcclxuICAgIH0pXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIGVkaXRQcm9maWxlU3VibWl0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIHNldEJ1dHRvblRleHQoZWRpdFByb2ZpbGVTdWJtaXRCdXR0b24sIGZhbHNlKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVOZXdQb3N0Rm9ybVN1Ym1pdChldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBzZXRCdXR0b25UZXh0KG5ld1Bvc3RTdWJtaXRCdXR0b24sIHRydWUpO1xyXG4gIGFwaVxyXG4gICAgLmFkZE5ld0NhcmQoe1xyXG4gICAgICBsaW5rOiBuZXdQb3N0SW1hZ2VJbnB1dC52YWx1ZSxcclxuICAgICAgbmFtZTogbmV3UG9zdENhcHRpb25JbnB1dC52YWx1ZSxcclxuICAgIH0pXHJcbiAgICAudGhlbigobmV3Q2FyZFZhbHVlcykgPT4ge1xyXG4gICAgICBjb25zdCBjYXJkID0gbmV3IENhcmQoXHJcbiAgICAgICAgbmV3Q2FyZFZhbHVlcyxcclxuICAgICAgICBcIiNjYXJkLXRlbXBsYXRlXCIsXHJcbiAgICAgICAgaGFuZGxlTGlrZSxcclxuICAgICAgICBoYW5kbGVEZWxldGVDYXJkLFxyXG4gICAgICAgIGhhbmRsZVByZXZpZXdcclxuICAgICAgKTtcclxuICAgICAgY2FyZExpc3QucHJlcGVuZChjYXJkLmdldENhcmRFbGVtZW50KCkpO1xyXG4gICAgICBtb2RhbHMubmV3UG9zdC5jbG9zZU1vZGFsKCk7XHJcbiAgICAgIG5ld1Bvc3RGb3JtLnJlc2V0KCk7XHJcbiAgICAgIHJlc2V0VmFsaWRhdGlvbihcclxuICAgICAgICBuZXdQb3N0Rm9ybSxcclxuICAgICAgICBuZXdQb3N0Rm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKSxcclxuICAgICAgICBzZXR0aW5nc1xyXG4gICAgICApO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGFkZGluZyBuZXcgY2FyZDpcIiwgZXJyb3IpO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgbmV3UG9zdFN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICBzZXRCdXR0b25UZXh0KG5ld1Bvc3RTdWJtaXRCdXR0b24sIGZhbHNlKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVFZGl0QXZhdGFyRm9ybVN1Ym1pdChldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBzZXRCdXR0b25UZXh0KGVkaXRBdmF0YXJTdWJtaXRCdXR0b24sIHRydWUpO1xyXG4gIGNvbnN0IGF2YXRhclVybCA9IGVkaXRBdmF0YXJJbnB1dC52YWx1ZTtcclxuICBhcGlcclxuICAgIC51cGRhdGVVc2VyQXZhdGFyKGF2YXRhclVybClcclxuICAgIC50aGVuKCh1cGRhdGVkVXNlckluZm8pID0+IHtcclxuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xyXG4gICAgICAgIGF2YXRhcjogdXBkYXRlZFVzZXJJbmZvLmF2YXRhcixcclxuICAgICAgfSk7XHJcbiAgICAgIG1vZGFscy5lZGl0QXZhdGFyLmNsb3NlTW9kYWwoKTtcclxuICAgICAgZWRpdEF2YXRhckZvcm0ucmVzZXQoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyBhdmF0YXI6XCIsIGVycm9yKTtcclxuICAgIH0pXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIGVkaXRBdmF0YXJTdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgc2V0QnV0dG9uVGV4dChlZGl0QXZhdGFyU3VibWl0QnV0dG9uLCBmYWxzZSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VibWl0KCkge1xyXG4gIHNldEJ1dHRvblRleHQoZGVsZXRlQ29uZmlybUJ1dHRvbiwgdHJ1ZSwgXCJEZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKTtcclxuICBhcGlcclxuICAgIC5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxyXG4gICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XHJcbiAgICAgIG1vZGFscy5kZWxldGVDYXJkLmNsb3NlTW9kYWwoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyBjYXJkOlwiLCBlcnJvcik7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBkZWxldGVDb25maXJtQnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIHNldEJ1dHRvblRleHQoZGVsZXRlQ29uZmlybUJ1dHRvbiwgZmFsc2UsIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlTGlrZShldnQsIGNhcmRJZCkge1xyXG4gIGNvbnN0IGNhcmRMaWtlQnV0dG9uID0gZXZ0LnRhcmdldDtcclxuICBjb25zdCBpc0xpa2VkID0gY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gIGFwaVxyXG4gICAgLmNoYW5nZUxpa2VTdGF0dXMoY2FyZElkLl9pZCwgIWlzTGlrZWQpXHJcbiAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgIGNhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIiwgIWlzTGlrZWQpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNoYW5naW5nIGxpa2Ugc3RhdHVzOlwiLCBlcnJvcik7XHJcbiAgICB9KTtcclxufVxyXG5cclxuLy8gRXZlbnQgbGlzdGVuZXJzXHJcbmVkaXRQcm9maWxlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY29uc3QgY3VycmVudFVzZXIgPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xyXG4gIGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlID0gY3VycmVudFVzZXIubmFtZTtcclxuICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBjdXJyZW50VXNlci5hYm91dDtcclxuICBtb2RhbHMuZWRpdFByb2ZpbGUub3Blbk1vZGFsKCk7XHJcbiAgcmVzZXRWYWxpZGF0aW9uKFxyXG4gICAgZWRpdFByb2ZpbGVGb3JtLFxyXG4gICAgZWRpdFByb2ZpbGVGb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2lucHV0XCIpLFxyXG4gICAgc2V0dGluZ3NcclxuICApO1xyXG59KTtcclxuXHJcbmVkaXRQcm9maWxlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRQcm9maWxlRm9ybVN1Ym1pdCk7XHJcbm5ld1Bvc3RCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG1vZGFscy5uZXdQb3N0Lm9wZW5Nb2RhbCgpKTtcclxubmV3UG9zdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVOZXdQb3N0Rm9ybVN1Ym1pdCk7XHJcbmVkaXRBdmF0YXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG1vZGFscy5lZGl0QXZhdGFyLm9wZW5Nb2RhbCgpKTtcclxuZWRpdEF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVFZGl0QXZhdGFyRm9ybVN1Ym1pdCk7XHJcbmRlbGV0ZUNvbmZpcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XHJcbmRlbGV0ZUNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuICBtb2RhbHMuZGVsZXRlQ2FyZC5jbG9zZU1vZGFsKClcclxuKTtcclxuXHJcbi8vIEVuYWJsZSB2YWxpZGF0aW9uXHJcbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xyXG4iLCJjbGFzcyBBcGkge1xyXG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XHJcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcclxuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrUmVzcG9uc2UocmVzKSB7XHJcbiAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gIH1cclxuXHJcbiAgZ2V0QXBwSW5mbygpIHtcclxuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XHJcbiAgfVxyXG5cclxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlVXNlckluZm8oW25hbWUsIGFib3V0XSkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgYWJvdXQsXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZVVzZXJBdmF0YXIoYXZhdGFyKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcixcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgYWRkTmV3Q2FyZCh7IG5hbWUsIGxpbmsgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBsaW5rLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICBkZWxldGVDYXJkKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG4gIGNoYW5nZUxpa2VTdGF0dXMoY2FyZElkLCBpc0xpa2VkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIlBVVFwiIDogXCJERUxFVEVcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBBcGk7XHJcbiIsImNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3Rvcih7IG5hbWVTZWxlY3RvciwgYWJvdXRTZWxlY3RvciwgYXZhdGFyU2VsZWN0b3IgfSkge1xyXG4gICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9hYm91dEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGFib3V0U2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXZhdGFyU2VsZWN0b3IpO1xyXG4gIH1cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50LFxyXG4gICAgICBhYm91dDogdGhpcy5fYWJvdXRFbGVtZW50LnRleHRDb250ZW50LFxyXG4gICAgICBhdmF0YXI6IHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjLFxyXG4gICAgfTtcclxuICB9XHJcbiAgc2V0VXNlckluZm8oeyBuYW1lLCBhYm91dCwgYXZhdGFyIH0pIHtcclxuICAgIGlmIChuYW1lKSB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICBpZiAoYWJvdXQpIHRoaXMuX2Fib3V0RWxlbWVudC50ZXh0Q29udGVudCA9IGFib3V0O1xyXG4gICAgaWYgKGF2YXRhcikgdGhpcy5fYXZhdGFyRWxlbWVudC5zcmMgPSBhdmF0YXI7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBVc2VySW5mbztcclxuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiY29uZmlnIiwiZXJyb3JNZXNzYWdlSUQiLCJpZCIsInF1ZXJ5U2VsZWN0b3IiLCJ0ZXh0Q29udGVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsIkFycmF5IiwiZnJvbSIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiYWRkIiwiZGlzYWJsZWQiLCJyZXNldFZhbGlkYXRpb24iLCJmb3JFYWNoIiwiZGlzYWJsZUJ1dHRvbiIsInNldEJ1dHRvblRleHQiLCJidXR0b24iLCJpc0xvYWRpbmciLCJkZWZhdWx0VGV4dCIsImxvYWRpbmdUZXh0IiwiY29uc3RydWN0b3IiLCJkYXRhIiwidGVtcGxhdGVTZWxlY3RvciIsImhhbmRsZUxpa2UiLCJoYW5kbGVEZWxldGUiLCJoYW5kbGVQcmV2aWV3IiwidGhpcyIsIl9kYXRhIiwiX3RlbXBsYXRlU2VsZWN0b3IiLCJfaGFuZGxlTGlrZSIsIl9oYW5kbGVEZWxldGUiLCJfaGFuZGxlUHJldmlldyIsIl9jYXJkVGVtcGxhdGUiLCJkb2N1bWVudCIsImNvbnRlbnQiLCJnZXRDYXJkRWxlbWVudCIsImNhcmRFbGVtZW50IiwiY2xvbmVOb2RlIiwiY2FyZFRpdGxlRWxlbWVudCIsImNhcmRJbWFnZUVsZW1lbnQiLCJjYXJkTGlrZUJ1dHRvbiIsImNhcmREZWxldGVCdXR0b24iLCJzcmMiLCJsaW5rIiwiYWx0IiwibmFtZSIsImlzTGlrZWQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZ0IiwibW9kYWwiLCJfbW9kYWwiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwiX2Nsb3NlQnV0dG9uIiwiY2xvc2VNb2RhbCIsInRhcmdldCIsIm9wZW5Nb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJrZXkiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRBcHBJbmZvIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJmZXRjaCIsInRoZW4iLCJ1cGRhdGVVc2VySW5mbyIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1cGRhdGVVc2VyQXZhdGFyIiwiYXZhdGFyIiwiYWRkTmV3Q2FyZCIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJjaGFuZ2VMaWtlU3RhdHVzIiwiYXV0aG9yaXphdGlvbiIsInVzZXJJbmZvIiwibmFtZVNlbGVjdG9yIiwiYWJvdXRTZWxlY3RvciIsImF2YXRhclNlbGVjdG9yIiwiX25hbWVFbGVtZW50IiwiX2Fib3V0RWxlbWVudCIsIl9hdmF0YXJFbGVtZW50Iiwic2V0VXNlckluZm8iLCJtb2RhbHMiLCJwcmV2aWV3IiwiTW9kYWwiLCJlZGl0UHJvZmlsZSIsIm5ld1Bvc3QiLCJlZGl0QXZhdGFyIiwicHJldmlld0ltYWdlRWxlbWVudCIsInByZXZpZXdDYXB0aW9uRWxlbWVudCIsImNhcmRMaXN0IiwiZWRpdFByb2ZpbGVCdXR0b24iLCJlZGl0UHJvZmlsZUZvcm0iLCJlZGl0UHJvZmlsZU5hbWVJbnB1dCIsImVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImVkaXRQcm9maWxlU3VibWl0QnV0dG9uIiwiZWRpdEF2YXRhckJ1dHRvbiIsImVkaXRBdmF0YXJGb3JtIiwiZWRpdEF2YXRhcklucHV0IiwiZWRpdEF2YXRhclN1Ym1pdEJ1dHRvbiIsIm5ld1Bvc3RCdXR0b24iLCJuZXdQb3N0Rm9ybSIsIm5ld1Bvc3RJbWFnZUlucHV0IiwibmV3UG9zdENhcHRpb25JbnB1dCIsIm5ld1Bvc3RTdWJtaXRCdXR0b24iLCJkZWxldGVDb25maXJtQnV0dG9uIiwiZGVsZXRlQ2FuY2VsQnV0dG9uIiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJoYW5kbGVEZWxldGVDYXJkIiwiX2lkIiwiY29udGFpbnMiLCJ0b2dnbGUiLCJjYXRjaCIsImVycm9yIiwiY29uc29sZSIsImNhcmRzIiwidXNlckRhdGEiLCJpdGVtIiwiY2FyZCIsIkNhcmQiLCJhcHBlbmQiLCJjdXJyZW50VXNlciIsInZhbHVlIiwicXVlcnlTZWxlY3RvckFsbCIsInByZXZlbnREZWZhdWx0IiwidXBkYXRlZFVzZXJJbmZvIiwicmVzZXQiLCJmaW5hbGx5IiwibmV3Q2FyZFZhbHVlcyIsInByZXBlbmQiLCJhdmF0YXJVcmwiLCJzZXRFdmVudExpc3RlbmVycyIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwidmFsaWRhdGlvbk1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9